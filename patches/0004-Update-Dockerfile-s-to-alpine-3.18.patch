From e71069c23b3c64cdf74ec54e13188d64103e0bcb Mon Sep 17 00:00:00 2001
From: Joe Groocock <me@frebib.net>
Date: Sat, 18 Jun 2022 08:41:02 +0000
Subject: Update Dockerfile(s) to alpine:3.18

Signed-off-by: Joe Groocock <me@frebib.net>
---
 docker/Dockerfile.agent.linux.amd64      | 6 +++---
 docker/Dockerfile.controller.linux.amd64 | 4 ++--
 docker/Dockerfile.controller.linux.arm   | 4 ++--
 docker/Dockerfile.controller.linux.arm64 | 4 ++--
 docker/Dockerfile.server.linux.amd64     | 6 +++---
 docker/Dockerfile.server.linux.arm       | 6 +++---
 docker/Dockerfile.server.linux.arm64     | 6 +++---
 7 files changed, 18 insertions(+), 18 deletions(-)

diff --git a/docker/Dockerfile.agent.linux.amd64 b/docker/Dockerfile.agent.linux.amd64
index bb9899a8..180b166e 100644
--- a/docker/Dockerfile.agent.linux.amd64
+++ b/docker/Dockerfile.agent.linux.amd64
@@ -1,7 +1,7 @@
-FROM alpine:3.11 as alpine
+FROM alpine:3.18 as alpine
 RUN apk add -U --no-cache ca-certificates tzdata
 
-FROM alpine:3.11
+FROM alpine:3.18
 ENV GODEBUG netdns=go
 ENV DRONE_RUNNER_OS=linux
 ENV DRONE_RUNNER_ARCH=amd64
@@ -9,7 +9,7 @@ ENV DRONE_RUNNER_PLATFORM=linux/amd64
 ENV DRONE_RUNNER_CAPACITY=1
 ADD release/linux/amd64/drone-agent /bin/
 
-RUN [ ! -e /etc/nsswitch.conf ] && echo 'hosts: files dns' > /etc/nsswitch.conf
+RUN test -e /etc/nsswitch.conf || echo 'hosts: files dns' > /etc/nsswitch.conf
 
 COPY --from=alpine /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/
 COPY --from=alpine /usr/share/zoneinfo /usr/share/zoneinfo
diff --git a/docker/Dockerfile.controller.linux.amd64 b/docker/Dockerfile.controller.linux.amd64
index 8161dc2c..d9b1c3ac 100644
--- a/docker/Dockerfile.controller.linux.amd64
+++ b/docker/Dockerfile.controller.linux.amd64
@@ -1,7 +1,7 @@
-FROM alpine:3.11 as alpine
+FROM alpine:3.18 as alpine
 RUN apk add -U --no-cache ca-certificates tzdata
 
-FROM alpine:3.11
+FROM alpine:3.18
 ENV GODEBUG netdns=go
 ENV DRONE_RUNNER_OS=linux
 ENV DRONE_RUNNER_ARCH=amd64
diff --git a/docker/Dockerfile.controller.linux.arm b/docker/Dockerfile.controller.linux.arm
index be509125..68f6bb29 100644
--- a/docker/Dockerfile.controller.linux.arm
+++ b/docker/Dockerfile.controller.linux.arm
@@ -1,7 +1,7 @@
-FROM alpine:3.11 as alpine
+FROM alpine:3.18 as alpine
 RUN apk add -U --no-cache ca-certificates tzdata
 
-FROM alpine:3.11
+FROM alpine:3.18
 ENV GODEBUG=netdns=go
 ENV DRONE_RUNNER_OS=linux
 ENV DRONE_RUNNER_ARCH=arm
diff --git a/docker/Dockerfile.controller.linux.arm64 b/docker/Dockerfile.controller.linux.arm64
index 54a1ca02..d42ec2bc 100644
--- a/docker/Dockerfile.controller.linux.arm64
+++ b/docker/Dockerfile.controller.linux.arm64
@@ -1,7 +1,7 @@
-FROM alpine:3.11 as alpine
+FROM alpine:3.18 as alpine
 RUN apk add -U --no-cache ca-certificates tzdata
 
-FROM alpine:3.11
+FROM alpine:3.18
 ENV GODEBUG=netdns=go
 ENV DRONE_RUNNER_OS=linux
 ENV DRONE_RUNNER_ARCH=arm64
diff --git a/docker/Dockerfile.server.linux.amd64 b/docker/Dockerfile.server.linux.amd64
index 1f4d604b..644ef63b 100644
--- a/docker/Dockerfile.server.linux.amd64
+++ b/docker/Dockerfile.server.linux.amd64
@@ -1,13 +1,13 @@
 # docker build --rm -f docker/Dockerfile -t drone/drone .
 
-FROM alpine:3.11 as alpine
+FROM alpine:3.18 as alpine
 RUN apk add -U --no-cache ca-certificates tzdata
 
-FROM alpine:3.11
+FROM alpine:3.18
 EXPOSE 80 443
 VOLUME /data
 
-RUN [ ! -e /etc/nsswitch.conf ] && echo 'hosts: files dns' > /etc/nsswitch.conf
+RUN test -e /etc/nsswitch.conf || echo 'hosts: files dns' > /etc/nsswitch.conf
 
 ENV GODEBUG netdns=go
 ENV XDG_CACHE_HOME /data
diff --git a/docker/Dockerfile.server.linux.arm b/docker/Dockerfile.server.linux.arm
index 3f803d15..d6873997 100644
--- a/docker/Dockerfile.server.linux.arm
+++ b/docker/Dockerfile.server.linux.arm
@@ -1,13 +1,13 @@
 # docker build --rm -f docker/Dockerfile -t drone/drone .
 
-FROM alpine:3.11 as alpine
+FROM alpine:3.18 as alpine
 RUN apk add -U --no-cache ca-certificates tzdata
 
-FROM alpine:3.11
+FROM alpine:3.18
 EXPOSE 80 443
 VOLUME /data
 
-RUN [ ! -e /etc/nsswitch.conf ] && echo 'hosts: files dns' > /etc/nsswitch.conf
+RUN test -e /etc/nsswitch.conf || echo 'hosts: files dns' > /etc/nsswitch.conf
 
 ENV GODEBUG netdns=go
 ENV XDG_CACHE_HOME /data
diff --git a/docker/Dockerfile.server.linux.arm64 b/docker/Dockerfile.server.linux.arm64
index f0be8284..d0377cac 100644
--- a/docker/Dockerfile.server.linux.arm64
+++ b/docker/Dockerfile.server.linux.arm64
@@ -1,13 +1,13 @@
 # docker build --rm -f docker/Dockerfile -t drone/drone .
 
-FROM alpine:3.11 as alpine
+FROM alpine:3.18 as alpine
 RUN apk add -U --no-cache ca-certificates tzdata
 
-FROM alpine:3.11
+FROM alpine:3.18
 EXPOSE 80 443
 VOLUME /data
 
-RUN [ ! -e /etc/nsswitch.conf ] && echo 'hosts: files dns' > /etc/nsswitch.conf
+RUN test -e /etc/nsswitch.conf || echo 'hosts: files dns' > /etc/nsswitch.conf
 
 ENV GODEBUG netdns=go
 ENV XDG_CACHE_HOME /data
-- 
2.41.0

